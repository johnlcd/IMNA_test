# IMNA
###  1. Introduction
------------
</br>

> **`IMNA`** is a integrative multi-omics network-based approach to capture genetic-driven regulatory networks for human complex diseases.  
This method can combine functional data from multiple biological scales to understand molecular mechanisms of disease and identify potential key genes.  
This pipeline provide several scripts facilitating data access, integration and analysis.

</br>

###  2. Download and Configure
------------
</br><b>2.1 Download</b>
<pre>
	git clone https://github.com/xjtugenetics/IMNA.git
</pre>

</br><b>2.2 Configure</b>
<pre>
	export IMNA_tk=/path/to/IMNA
</pre>

</br>

###  3. Tutorial
------------
</br>  

- **Workflow**  

![IMNA workflow](https://github.com/xjtugenetics/IMNA/blob/master/workflow.png)

</br><b>3.1 Export gene set and module information </b>
```bash
Script:
		1-Export_module.py
		
Usage:
		python3 ${IMNA_tk}/script/1-Export_module.py <inpmoduledir> <oup>

```

##### Details for parameters:  
<pre>
inpmoduledir          Directory of all gene module (gene list)
oup                   Prefix of output file
</pre>

##### Output file(s):  
> ***oup.txt***: Gene set (module)  
> ***oup_info.txt***: Module information  

</br><b>3.2 Constract bipartite based on SNP-gene pairs</b>
```bash
Script:
		2-Constract_bipartite.py

Usage:
		python3 ${IMNA_tk}/script/2-Constract_bipartite.py <GS pair> <oup>

```

##### Details for parameters:
<pre>
GS pair               Gene-SNP pairs 
oup                   Prefix of output file
</pre>

##### Output file(s):
> ***oup_DG_snp.txt***: Raw SNP degree score  
> ***oup_DG_gene.txt***: Raw gene degree score  
> ***oup_DG_gene.nor.txt***: Normalized gene degree score  

</br><b>3.3 KDA - Key driver analysis </b>
```bash
Script:
		3-KDA_analysis.py

Usage:
		python3 ${IMNA_tk}/script/3-KDA_analysis.py <GS pair> <modulefile> <oup>

```

##### Details for parameters:
<pre>
GS pair               Gene-SNP pairs
modulefile            module file, conducted by 1-Export_module.py
oup                   Prefix of output file
</pre>

##### Output file(s):
> ***oup_KDA-module.txt***: Gene module set  
> ***oup_KDA-score.txt***: Gene enrichment score  

</br><b>3.4 SS - Signature score analysis </b>
```bash
Script:
		4-Combine_bip_SScore.py

Usage:
		python3 ${IMNA_tk}/script/4-Combine_bip_SScore.py <inter_score> <module> <oup>

```

##### Details for parameters:
<pre>
inter_score           Interaction score of database (PPI, GIANT)
module                Gene set module (step 1 output)
oup                   Prefix of output file
</pre>

##### Output file(s):
> ***oup_SScore.txt***: Combined gene signiture score  

</br><b>3.5 CS - Composite score analysis </b>
```bash
Script:
		5-Composite_score.py

Usage:
		python3 ${IMNA_tk}/script/5-Composite_score.py <PPI_SScore> <GIANT_SScore> <oup>

```

##### Details for parameters:
<pre>
PPI_SScore            Gene signiture score of PPI network (step 4 output)
GIANT_SScore          Gene signiture score of GIANT network (step 4 output)
oup                   Prefix of output file
</pre>

##### Output file(s):
> ***oup_Composite_score.txt***: Gene composite score (PPI and GIANT network)  

</br>  


###  4. Example
------------
</br>

* Calculate gene composition score of 6 gene set modlue accoding to gene interaction from PPI and GIANT netwrok

```sh
###Step1:  

		python3 ${IMNA_tk}/script/1-Export_module.py ${IMNA_tk}/data/geneset module

        ## "module.txt"
		gene	module	moduleset
		SLC15A1	101	1
		FLOT1	101	1
		MTMR9	101	1
		C14orf135	101	1
		CMTM6	101	1
		DAAM1	101	1
		HOXA10	101	1
		ZNF84	101	1
		GMPR	101	1

        ## "module_info.txt"
		module	name
		101	263-signatures-ori.txt
		102	100-signatures-ori.txt
		103	300-signatures-ori.txt
		104	39-signatures-ori.txt
		105	126-signature-ori.txt
		106	14-signatures-ori.txt

```
```sh
###Step2:  

		python3 ${IMNA_tk}/script/2-Constract_bipartite.py snp.gene.pairs bip

		## "snp.gene.pairs"
		ENTREZID	SNP
		5243	rs185481544
		11086	rs28465148
		11086	rs7669284
		11086	rs11934547
		11086	rs28436676
		11086	rs59826661
		11086	rs4469051
		11086	rs7669051
		11086	rs4459969

		## "bip_DG_snp.txt"
		DG	Node
		0.02097902097902098	rs62064394
		0.006993006993006993	rs117404018
		0.006993006993006993	rs117916627
		0.006993006993006993	rs139268110
		0.006993006993006993	rs112746008
		0.006993006993006993	rs34719019
		0.006993006993006993	rs117187923
		0.006993006993006993	rs114433718
		0.02097902097902098	rs12150223

		## "bip_DG_gene.txt"
		DG	Node
		0.00022660321776569228	580
		0.00022660321776569228	752
		0.00022660321776569228	148345
		0.00022660321776569228	246744
		0.00022660321776569228	1021
		0.00022660321776569228	1267
		0.1907999093587129	1394
		0.00045320643553138455	1545
		0.00022660321776569228	83468

		## "bip_DG_gene.nor.csv"
		DG	Node	Norm
		0.22003172445048721	284058	1.0
		0.1907999093587129	1394	0.8670103092783505
		0.1470654883299343	4137	0.6680412371134021
		0.10151824155903014	9884	0.4608247422680412
		0.10061182868796738	474170	0.4567010309278351
		0.09811919329254476	51326	0.44536082474226807
		0.05030591434398369	389170	0.22783505154639178
		0.04146838885112169	8631	0.18762886597938144
		0.024699750736460458	100506084	0.11134020618556702

```
```sh
###Step3:  

		python3 ${IMNA_tk}/script/3-KDA_analysis.py PPI.txt  module.txt  PPI
		python3 ${IMNA_tk}/script/3-KDA_analysis.py GIANT.txt  module.txt  GIANT

		## "GIANT_KDA-module.txt"
		gene	geneset	pval
		441533	1	1.0
		131408	1	0.28285714285683794
		81928	1	1.0
		57213	1	1.0
		65244	1	1.0
		9967	1	1.0
		388468	1	1.0
		157680	1	1.0
		6160	1	1.0

		## "GIANT_KDA-score.txt"
		gene	norm1	norm2	norm3	norm4	norm5	norm6	score	norm
		10197	1.0	0.29090055514993624	0.9611261528499372	0.8871992083108299	0.04650894281166654	0.9611741129064666	0.6911514953381394	1.0
		3093	0.4294140696702908	0.4667958659253854	1.0	1.0	0.43784301335436276	0.6350195906365339	0.6615120899310956	0.9571159064156506
		56942	0.7709455707545094	0.5210496001019198	0.7043657570792498	0.8513415645594326	0.04901572241383033	0.9999999999999999	0.649453035818157	0.939668133829933
		8678	0.3490195967151135	1.0	0.5739366363871888	0.3837992317220161	0.3620641232131899	0.5748366391547141	0.5406093711987038	0.7821865030245152
		3612	0.5531510328480921	0.9806686088945384	0.36490866036163244	0.38763926502330237	0.026679242597937546	0.8553370656268788	0.5280639792253968	0.764035067256921
		55839	0.4187412106118528	0.96392330915934	0.7057566765779486	0.2042535063085521	0.07538627118064414	0.7208577462952869	0.5148197866889375	0.7448725643530102
		10951	0.7951715632059919	0.40617231592755343	0.7072771811434451	0.18027888766015995	0.32939959167086363	0.5806397684566302	0.499823218010774	0.7231746171166716
		9055	0.5825916239791068	0.544346171624612	0.5831677106084262	0.0708943287583114	0.2991357202189646	0.4902208091296332	0.4283927273865091	0.6198246408725803
		130507	0.49775826010598495	0.1337393537865153	0.7072771811434451	0.532446321865361	0.07601658527750611	0.5015690151459162	0.4081344528874548	0.5905137377844765

		## "PPI_KDA-module.txt"
		gene	geneset	pval
		7040	1	1.0
		57156	1	1.0
		253558	1	1.0
		343035	1	1.0
		9612	1	1.0
		51330	1	1.0
		54622	1	1.0
		55869	1	1.0
		11169	1	1.0

		## "PPI_KDA-score.txt"
		gene	norm1	norm2	norm3	norm4	norm5	norm6	score	norm
		51226	0.13689060369192466	0.23546376360540278	0.0	1.0	0.0	0.4382110956146653	0.3017609104853321	1.0
		3292	0.5575640372630015	0.0	0.44956984237390485	0.0	0.0	0.6974338837005016	0.28409462722290135	0.9414560247912247
		4137	0.20538075591266292	0.0	0.0	0.8334981251435271	0.13754192393767092	0.5205679713454968	0.2828314627232263	0.9372700469001736
		5158	0.0	0.10834928171743216	1.0	0.1940660952985408	0.2805059641185765	0.0	0.2638202235224249	0.8742690466373332
		26276	1.0	0.0	0.0	0.0	0.19190279740944863	0.3796594475046632	0.26192704081901863	0.8679952628647385
		6155	0.044205949445568465	0.0	0.0	0.11679125075405203	1.0	0.2042808236152811	0.2275463373024836	0.7540616739806136
		55839	0.3412549076191583	0.0	0.0	0.0	0.0	1.0	0.22354248460319304	0.7407933792473725
		1021	0.24599114303079908	0.614112426696306	0.0	0.3242567352411694	0.0	0.1302980465009952	0.2191097252448783	0.7261037385275543
		23331	0.4495563352500804	0.3188269367583939	0.0	0.0	0.0	0.5243836012325154	0.21546114554016493	0.7140127765177791

```
```sh
###Step4:  

		python3 ${IMNA_tk}/script/4-Combine_bip_SScore.py PPI_KDA-score.txt bip_DG_gene.nor.csv PPI
		python3 ${IMNA_tk}/script/4-Combine_bip_SScore.py GIANT_KDA-score.txt bip_DG_gene.nor.csv GIANT

		## "PPI_SScore.txt"
		norm1	norm2	norm3	norm4	norm5	norm6	score	gene	norm
		0.3425835701718439	0.0	0.0	1.3903092437961102	0.22942560095995007	0.8683288429247565	0.4717745429754434	4137	1.0
		0.1371728523593307	0.23594925590149643	0.0	1.002061855670103	0.0	0.4391146236468605	0.3023830979296318	51226	0.6409483140453623
		0.5575640372630015	0.0	0.4495698423739049	0.0	0.0	0.6974338837005016	0.28409462722290135	3292	0.60218303732783
		0.0	0.10834928171743216	1.0	0.1940660952985408	0.2805059641185765	0.0	0.2638202235224249	5158	0.5592082647328369
		1.0030927835051546	0.0	0.0	0.0	0.19249631121586963	0.3808336519814817	0.2627371244504177	26276	0.5569124666908819
		0.4843158457075608	0.3434785040335274	0.0	0.0	0.0	0.5649287250391531	0.23212051246337354	23331	0.4920157645628958
		0.04420594944556847	0.0	0.0	0.11679125075405206	1.0	0.2042808236152811	0.2275463373024836	6155	0.48232008422363676
		0.3412549076191583	0.0	0.0	0.0	0.0	1.0	0.22354248460319304	55839	0.47383329162554827
		0.2459911430307991	0.6141124266963061	0.0	0.3242567352411694	0.0	0.1302980465009952	0.2191097252448783	1021	0.4644373642184489

		## "GIANT_SScore.txt"
		gene	norm1	norm2	norm3	norm4	norm5	norm6	score	norm_x	dg	norm_y
		10197	1.0	0.29090055514993624	0.9611261528499372	0.8871992083108299	0.04650894281166654	0.9611741129064666	0.6911514953381394	1.0	1.0	0.0
		3093	0.4294140696702908	0.4667958659253854	1.0	1.0	0.4378430133543628	0.6350195906365339	0.6615120899310956	0.9571159064156506	1.0	0.0
		56942	0.7709455707545094	0.5210496001019198	0.7043657570792498	0.8513415645594326	0.04901572241383033	1.0	0.6494530358181569	0.939668133829933	1.0	0.0
		8678	0.3490195967151135	1.0	0.5739366363871888	0.3837992317220161	0.3620641232131899	0.5748366391547141	0.5406093711987038	0.7821865030245152	1.0	0.0
		3612	0.5531510328480921	0.9806686088945384	0.3649086603616325	0.3876392650233024	0.026679242597937542	0.8553370656268788	0.5280639792253968	0.7640350672569209	1.0	0.0
		55839	0.4187412106118528	0.96392330915934	0.7057566765779486	0.2042535063085521	0.07538627118064414	0.7208577462952869	0.5148197866889375	0.7448725643530102	1.0	0.0
		10951	0.7951715632059919	0.40617231592755343	0.7072771811434451	0.18027888766015995	0.32939959167086363	0.5806397684566302	0.49982321801077395	0.7231746171166716	1.0103092783505154	0.010309278350515464
		9055	0.5825916239791068	0.5443461716246121	0.5831677106084262	0.0708943287583114	0.2991357202189646	0.4902208091296332	0.4283927273865091	0.6198246408725803	1.0288659793814432	0.028865979381443294
		130507	0.497758260105985	0.1337393537865153	0.7072771811434451	0.532446321865361	0.07601658527750611	0.5015690151459162	0.4081344528874548	0.5905137377844765	1.0	0.0

```
```sh
###Step5:  

		python3 ${IMNA_tk}/script/5-Composite_score.py PPI_SScore.txt GIANT_SScore.txt combined-result

		## "KDA-GIANT-PPI_Composite_score.txt"
		SYMBOL	norm_x	norm_y	mean	score
		PSME3	0.36889012627238704	1.0	0.6844450631361936	1.0
		CENPN	0.473833291625548	0.7448725643530101	0.6093529279892791	0.8902875640554189
		MAPT	1.0	0.153268297911711	0.5766341489558555	0.8424841963409919
		UBE2K	0.143217400085047	0.9571159064156508	0.5501666532503489	0.8038141888692015
		CMC2	0.0526738001124461	0.939668133829933	0.49617096697118956	0.7249244587983237
		BECN1	0.204518423360733	0.7821865030245151	0.49335246319262405	0.7208065186883448
		PRC1	0.325504807961021	0.637716486176119	0.48161064706857	0.7036512833649254
		RPL27	0.48232008422363704	0.446961560578953	0.464640822401295	0.6788577307757409
		IMPA1	0.156525868298544	0.7640350672569209	0.46028046777773246	0.6724870885454017

```

</br>


###  5. License
------------
</br>  

> This software is distributed under the terms of GPL 2.0
</br>


###  6. Source
------------
</br>  

> [https://github.com/xjtugenetics/IMNA](https://github.com/xjtugenetics/IMNA)
</br>


###  7. Contact
------------
</br>  

#### Author
> **Yi-Xiao Chen**, **Shan-Shan Dong**, **Yan Guo**, **Tie-Lin Yang**  
> Key Laboratory of Biomedical Information & Genetics Center, School of Life Science and Technology, Xi'an Jiaotong University, Xi'an, Shaanxi Province, 710049, P. R. China  
> [:email:](yangtielin@mail.xjtu.edu.cn) yangtielin@mail.xjtu.edu.cn  
</br>


###  8. Maintainer
------------
</br>  

> **Yi-Xiao Chen**  
> You can contact [:email:](aaa@stu.xjtu.edu.cn) aaa@stu.xjtu.edu.cn
  when you have any questions, suggestions, comments, etc.
> Please describe in details, and attach your command line and log messages if possible.  
</br>


###  9. Requiremnets
------------
</br>  
	
- **Python** ( >= 3.2 )
	- numpy( >=1.10.4)
	- mpmath( >=0.19)
	- pandas( >=0.18.0)
	- scipy( >= 0.17.0)
	- rpy2( >= 2.9.0)
- **R** \( >= 3.3.2 \)
</br>


###################### No pain, no gain. #############################

